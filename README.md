# M5StackRFID2 NDEF Reader

RFID Reader for M5Stack RFID 2 Unit (WS1850S/MFRC522 I2C)

can read NDEF messages off any Mifare Ultralight and Mifare Classic cards I could get my hands on

tested on M5Stack Core2 and CoreS3

## API

see [NDEF Library for Arduino by TheNitek](https://github.com/TheNitek/NDEF).

## History

taken from [M5StackRFID2Writer](https://github.com/ksasao/M5StackRFID2Writer)
the key tester came from [mifare-classic-toolkit](https://github.com/XaviTorello/mifare-classic-toolkit.git)

brushed up to use C++ const refs instead of pointers


## Reading a RuuviTag with NFC

This documents my experience trying to read a RuuviTag's NFC-readble information. I tried with several reader platforms:

- Samsung Galaxy S10 model SM-G973F/DS, Android 12
- Samsung Galaxy A13 SG model SM-A136B/DSN, Android 13
- iPhone 12 Pro Max, iOS 17.1.2
- [ACR122U-A9 USB NFC reader](https://www.acs.com.hk/en/products/3/acr122u-usb-nfc-reader/), NFC Tools for Desktop v2.6 on MacOS
- [M5Stack RFID2 reader](https://shop.m5stack.com/products/rfid-unit-2-ws1850s) running off an ESP32/ESPS3

### Phone software tools

Recommended: NFC Tools by wakdev ([iOS](https://apps.apple.com/us/app/nfc-tools/id1252962749) and [Android](https://play.google.com/store/apps/details?id=com.wakdev.wdnfc))
The Android version is a bit easier to use.

Also useful: [NXP Tag Info](https://play.google.com/store/apps/details?id=com.nxp.taginfolite) on Android.

### Ruuvi tags used

- a RuuviTag PRO, Ruuvi2B44, 3in1, single button - I assume Hw Rev.B8, production timestamp 2421, battery 2.55V
- a RuuviTag 4in1, Ruuvi5668, dual button - I assume Hw Rev.N7.1 (or earlier?), production timestamp 1020, battery 2.89V

Both tags report RuuviTag B, FW v.3.31.1+default in RuuviStation.

I could read or at least detect the RuuviTag PRO (Ruuvi2B44) with all of the above readers.
I could never detect the RuuvTag 4in1 (Ruuvi5668) with any reader.

### RuuviTag - area of NFC sensitivity

I initially removed the PCB's from the case to get the antenna closer to the reader. The read area shows the NFC coil - the area of highest sensitiviy:

![Alt text](assets/ruuvitag.jpg?raw=true)

This corresponds to the following area on the RuuviTag PRO case:

![Alt text](assets/pro-case.jpg?raw=true )


### Phones - area of NFC sensitivity

This seems to vary from model to model - my subjective take on the area of NFC sensitivity - from left to right: Galaxy A13, Galaxy S10, iPhone 12 Pro Max


![Alt text](assets/phones.jpg?raw=true)

### NFC content 

This report was generated by [NXP Tag Info](https://play.google.com/store/apps/details?id=com.nxp.taginfolite) on Android:

```
** TagInfo Scan (version 4.28.0) 04-Dez.-23 18:58:39 **
Report Type: -- IC INFO ------------------------------

# IC Manufacturer:
Nordic Semiconductor

# IC Type:
Unknown IC implementing ISO/IEC 14443-4

# NFC Forum NDEF-compliant tag:
Type 4 Tag

# Application information:
Type 4 Tag v2 application present

-- NDEF ------------------------------

# NFC data set information:
NDEF message containing 4 records
Current message size: 129 bytes
Maximum message size: 238 bytes
NFC data set access: Read & Write

# Record #1: Text record:
Type Name Format: NFC Forum well-known type
Short Record
type: "T"
encoding: UTF-8
lang: "id"
text: "ID: C5:5A:B4:FC:52:5C:F4:B2"
Payload length: 30 bytes
Payload data:

[00] 02 69 64 49 44 3A 20 43 35 3A 35 41 3A 42 34 3A |.idID: C5:5A:B4:|

[10] 46 43 3A 35 32 3A 35 43 3A 46 34 3A 42 32       |FC:52:5C:F4:B2  |


# Record #2: Text record:
Type Name Format: NFC Forum well-known type
Short Record
type: "T"
encoding: UTF-8
lang: "ad"
text: "MAC: C2:6E:D1:70:2B:44"
Payload length: 25 bytes
Payload data:

[00] 02 61 64 4D 41 43 3A 20 43 32 3A 36 45 3A 44 31 |.adMAC: C2:6E:D1|

[10] 3A 37 30 3A 32 42 3A 34 34                      |:70:2B:44       |


# Record #3: Text record:
Type Name Format: NFC Forum well-known type
Short Record
type: "T"
encoding: UTF-8
lang: "sw"
text: "SW: Ruuvi FW v3.31.1+default"
Payload length: 31 bytes
Payload data:

[00] 02 73 77 53 57 3A 20 52 75 75 76 69 20 46 57 20 |.swSW: Ruuvi FW |

[10] 76 33 2E 33 31 2E 31 2B 64 65 66 61 75 6C 74    |v3.31.1+default |


# Record #4: Text record:
Type Name Format: NFC Forum well-known type
Short Record
type: "T"
encoding: UTF-8
lang: "dt"
text: -- deleted - unprintable chars --
Payload length: 27 bytes
Payload data:

[00] 02 64 74 05 16 60 41 87 FF FF 03 10 FE 14 02 24 |.dt..`A........$|

[10] 7D 56 1A 00 0B C2 6E D1 70 2B 44                |}V....n.p+D     |


# NDEF message:
[00] 91 01 1E 54 02 69 64 49 44 3A 20 43 35 3A 35 41 |...T.idID: C5:5A|

[10] 3A 42 34 3A 46 43 3A 35 32 3A 35 43 3A 46 34 3A |:B4:FC:52:5C:F4:|

[20] 42 32 11 01 19 54 02 61 64 4D 41 43 3A 20 43 32 |B2...T.adMAC: C2|

[30] 3A 36 45 3A 44 31 3A 37 30 3A 32 42 3A 34 34 11 |:6E:D1:70:2B:44.|

[40] 01 1F 54 02 73 77 53 57 3A 20 52 75 75 76 69 20 |..T.swSW: Ruuvi |

[50] 46 57 20 76 33 2E 33 31 2E 31 2B 64 65 66 61 75 |FW v3.31.1+defau|

[60] 6C 74 51 01 1B 54 02 64 74 05 16 60 41 87 FF FF |ltQ..T.dt..`A...|

[70] 03 10 FE 14 02 24 7D 56 1A 00 0B C2 6E D1 70 2B |.....$}V....n.p+|

[80] 44                                              |D               |


# Capability Container (CC) file content:
Mapping version 2.0
CC length: 15 bytes
Maximum Le value: 248 bytes
Maximum Lc value: 248 bytes
NDEF File Control TLV:
* Length: 6 bytes
* NDEF file ID: 0xE104
* Maximum NDEF data size: 240 bytes
* NDEF access: Read & Write
[0] 00 0F 20 00 F8 00 F8 04 06 E1 04 00 F0 00 00    |.. ............ |


# Type 4 Tag File Control Information (FCI):
Type 4 Tag v2 application FCI: [none]
CC file FCI: [none]
NDEF file FCI: [none]

# NDEF file contents:
[00] 00 8D 81 01 00 00 00 1E 54 02 69 64 49 44 3A 20 |........T.idID: |

[10] 43 35 3A 35 41 3A 42 34 3A 46 43 3A 35 32 3A 35 |C5:5A:B4:FC:52:5|

[20] 43 3A 46 34 3A 42 32 01 01 00 00 00 19 54 02 61 |C:F4:B2......T.a|

[30] 64 4D 41 43 3A 20 43 32 3A 36 45 3A 44 31 3A 37 |dMAC: C2:6E:D1:7|

[40] 30 3A 32 42 3A 34 34 01 01 00 00 00 1F 54 02 73 |0:2B:44......T.s|

[50] 77 53 57 3A 20 52 75 75 76 69 20 46 57 20 76 33 |wSW: Ruuvi FW v3|

[60] 2E 33 31 2E 31 2B 64 65 66 61 75 6C 74 41 01 00 |.31.1+defaultA..|

[70] 00 00 1B 54 02 64 74 05 16 60 41 87 FF FF 03 10 |...T.dt..`A.....|

[80] FE 14 02 24 7D 56 1A 00 0B C2 6E D1 70 2B 44    |...$}V....n.p+D |


-- EXTRA ------------------------------

# TagInfo Version:
Version :4.28.0

# Device Info:
Device Model :samsung ( SM-A136B )
Android OS Version :13

-- FULL SCAN ------------------------------

--------------------------------------
```

### M5Stack RFID2 Reader

I'm currently dabbling with an MRFC522-based reader connected to an ESP32S3, repo here: https://github.com/mhaberler/M5StackRFID2-Reader

the code does not yet support ISO/IEC 14443-4 cards yet, however it can detect the tag's presence, so just a matter of time.

